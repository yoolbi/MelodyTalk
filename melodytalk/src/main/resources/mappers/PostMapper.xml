<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.global.react.mapper.PostMapper">

	<select id="getAllPosts" resultType="com.global.react.domain.PostVO">
		<![CDATA[
			SELECT 
			    p.POST_ID,
			    p.USER_ID,
			    p.CONTENT,
			    p.IMAGE,
			    p.MUSIC_FILE_NAME,
			    p.COPYRIGHT,
			    p.CREATEDATE,
			    (SELECT COUNT(*) FROM LIKES l WHERE l.POST_ID = p.POST_ID) AS LIKE_COUNT
			FROM 
			    POST p
		]]>
	</select>
	
	<select id="getPostsByUserID" resultType="com.global.react.domain.PostVO">
		<![CDATA[
			SELECT 
			    p.POST_ID,
			    p.USER_ID,
			    p.CONTENT,
			    p.IMAGE,
			    p.MUSIC_FILE_NAME,
			    p.COPYRIGHT,
			    p.CREATEDATE,
			    (SELECT COUNT(*) FROM LIKES l WHERE l.POST_ID = p.POST_ID) AS LIKE_COUNT
			FROM 
			    POST p
			WHERE USER_ID = #{userID}
		]]>
	</select>
	
	<insert id="insertPost">
		INSERT INTO POST (
			POST_ID
			,USER_ID
			,CONTENT
			,IMAGE
			,MUSIC_FILE_NAME
			,COPYRIGHT
		) values (
			#{post_id}
			,#{user_id}
			,#{content}
			,#{image}
			,#{music_file_name}
			,#{copyright}
		)
	</insert>
	
	<delete id="deletePost">
		DELETE POST WHERE POST_ID = #{post_id}
	</delete>

</mapper>
